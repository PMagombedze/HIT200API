{% include 'imports.html' %}

<script>
    const token = cookie.get('dash_token');
    if (!token) {
        window.location.href = '/login';
    }

    fetch('/api/verifyToken', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.message !== "Token is valid") {
                window.location.href = '/';
            } else {
                document.getElementById('otp-section').style.display = 'block';
            }
        })
        .catch(error => {
            window.location.href = '/login';
        });
</script>

<!-- Initially hidden section -->
<div id="otp-section" style="display: none;">
    <section class="hero is-fullheight">
        <div class="hero-body">
            <div class="container has-text-centered">
                <div class="box" style="max-width: 400px; margin: 0 auto; box-shadow: none; border: 1px solid #f1f1f1;">
                    <h2 class="title">OTP Code Verification </h2>
                    <p class="subtitle is-6 mt-2">Please enter the OTP code sent to your email.</p>
                    <form class="otp-form">
                        <div class="field">
                            <div class="control">
                                <input class="input" id="OTP" type="text" placeholder="Enter your OTP"
                                    style="width: 100%; height: 50px;">
                            </div>
                        </div>
                        <div class="field">
                            <div class="control">
                                <button style="width: 100%; height: 50px;" id="verify-otp" class="button is-link"
                                    type="submit">Verify OTP</button>
                            </div>
                        </div>
                        <p class="subtitle is-6 mt-2">Didn't receive the OTP code? <a id="resendOtp"
                                class="has-text-weight-bold">Resend OTP</a></p>
                    </form>
                </div>
            </div>
        </div>
    </section>
</div>